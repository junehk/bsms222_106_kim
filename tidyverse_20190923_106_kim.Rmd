---
title: "5. The tidyverse"
output: html_notebook
---

## 5.7 Sumarizing data

An important part of exploratory data analysis is summarizing data. The average and standard deviation are two examples of widely used summary statistics. More informative summaries can often be achieved by first splitting data into groups. In this section, we cover two new **dplyr** verbs that make these computations easier: `summarize` and `group_by`. We learn to access resulting values using the `pull` function.

> standard deviation : 표준편차

### 5.7.1 `summarize`

The `summarize` function in **dplyr** provides a way to compute summary statistics with intuitive and readable code. We start with a simple example based on `heights`. The heights dataset includes heights and sex reported by students in an in-class survey.

```{r}
library(dplyr)
library(dslabs)
data(heights)
```

The following code computes the average and standard deviation for females:

```{r}
s <- heights %>%
  filter(sex == "Female") %>%
  summarize(average = mean(height), standard_deviation = sd(height))

print(s)
```

This takes our orignal data table as input, filters it to keep only females, and then produces a new summarized table with just the average and the standard deviation of heights. We get to choose the names of the columns of the resulting table. For example, above we decided to use `average` and `standard_deviation`, but we could have used names just the same.

Because the resulting table stored in `s` is a data frame, we can access the components with the accessor `$` :

```{r}
s$average
s$standard_deviation
```


As with most other **dplyr** functions, `summarize` is aware of the variable named and we cna use them directly. So when inside the call to the `summarize` function we write `mean(height)`, the function is accessing the column with the name "height" and then computing the average of the resulting numeric vector. We can compute any other summary that operates on vectors and returns a single value. For example, we can add the median, min and max heights like this:

```{r}
heights %>%
  filter(sex == "Female") %>%
  summarize(median = median(height), minimun = min(height), maximum = max(height))
```

We can obtain these three values with just one line using the `quantile` function: for example, `quantile(x, c(0, 0.5, 1))` returns the min (0th percentile), median(50th percentile), and max(100th percentile) of the vector `x`. However, if we attempt to use a function like this that returns two or more values inside `summerize`:

```{r}
heights %>% 
  filter(sex == "Female") %>%
  summarize(range = quantile(height, c(0, 0.5, 1)))
```

we will receive an error: `Error: expecting result of length one, fot : 2`. With the function `summarize`, we can only call functions that return a single value. In section **5.12**, we will learn how to deal with funcitons that return more than one value.

For another exapmle of how we can use the `summarize` function, let's compute the average murder rate for the United States. Remember our data table includes total murders and population size for each state and we have already used **dplyr** to add a murder rate column:

```{r}
data(murders)
murders <- murders %>% mutate(rate = total/population*100000)
```

Remember that the US murder rate is **not** the average of the state murder rates:

```{r}
summarize(murders, mean(rate))
```
This is because in the computation above the small states are given the same weight as the large ones. The US murder rate is the total number of murders in the US divided by the total US population. So the correct computation is:

```{r}
us_murder_rate <- murders %>%
  summarize(rate = sum(total) / sum(population) * 100000)
print(us_murder_rate)
```

This computaion counts larger states proportionally to theri size which results in a larger value.

### 5.7.2 `pull`

The `us_murder_rate` object defined above represents just one number. Yet we are storing it in a data frame:

```{r}
class(us_murder_rate)
```

since, as most **dplyr** functions, `summarize` always returns a data frame.

This might be problematic if we want to use this result with functions that require a numeric value.


